<%= render partial: 'layouts/sidebar' %>

<div class="carpost">

  <h3><%= @carpost.title %></h3>

    <div class="carpost-show">

      <div class="carpost-time">
        <%= @carpost.created_at.strftime('%Y/%m/%d %H:%M:%S') %>
      </div>

      <div class="carpost-user">
        <div class="user-image">
          <% if @carpost.user.plofile_image.attached? %>
            <%= link_to user_path(@carpost.user.id) do %>
              <%= image_tag @carpost.user.plofile_image, class: "plofile-image" %>
            <% end %>
          <% else %>
            <%= link_to user_path(@carpost.user.id) do %>
              <%= image_tag 'no_image.jpg', class: "no_image" %>
            <% end %>
          <% end %>
        </div>

        <div class="carpost-user-right">
          <div class="name"><%=link_to @carpost.user.name, user_path(@carpost.user.id) %></div>
          <div class="car-name"><%= link_to @carpost.user.maker_genre.mname, user_path(@carpost.user.id) %>. <%= link_to @carpost.user.car_name, user_path(@carpost.user.id) %></div>
        </div>

        <div class="follow">

          <% if @carpost.user.id == current_user.id %>
            <div class="show-user-edit">
              <%= link_to "User Edit", edit_user_path(@carpost.user.id), class: "edit-btn" %>
            </div>
              <% else %>
                <% if current_user.following(@carpost.user) %>
                  <%= link_to "フォロー外す", user_relationships_path(@carpost.user.id), method: :delete %>
                <% else %>
                  <%= link_to "フォローする", user_relationships_path(@carpost.user.id), method: :post %>
                <% end %>
          <% end %>

        </div>
      </div>

      <div class="carpost-image"><%= image_tag @carpost.car_image, class: "car-image" %></div>

      <div class="show-carpost-btn">
        <div class="show-carpost-good">
          <% if @carpost.gooded?(current_user) %>
            <%= link_to car_post_good_path(@carpost.id), method: :delete do %>
              <span style="color:red;">★いいね！</span>
            <% end %>
          <% else %>
            <%= link_to car_post_goods_path(@carpost.id), method: :post do %>
              <span>◆いいね！</span>
            <% end %>
          <% end %>
          <%= @good_count %>
        </div>
        <div class="show-carpost-comment-count">
          コメント<%= @comment_count %>
        </div>
      </div>

      <div class="carpost-text">
        <div class="carpost-genre">
          ジャンル:<%= @carpost.parts_genre.pname %>
        </div>
        <div class="text">
          <%= @carpost.message %>
        </div>
      </div>

      <div class="carpost-edit">
        <% if @carpost.user == current_user %>
          <div class="edit"><%= link_to "編集する", edit_car_post_path(@carpost.id) %></div>
          
      <% end %>
      </div>

    </div>

    <div class="carpost-comment">
      <h2>Comment!</h2>
    </div>

    <div class="comment-post">
      <%= form_with(model:[@carpost, @comment], method: :post) do |f| %>
        <div class="text"><%= f.text_area :post_comment %></div>
        <div class="submit"><%= f.submit 'コメントする' %></div>
      <% end %>

    </div>



      <% @comments.each do |comment| %>
        <div class="comments">
          <div class="comments-user">
            <div class="user-image">
              <% if comment.user.plofile_image.attached? %>
                <%= link_to user_path(comment.user.id) do %>
                  <%= image_tag comment.user.plofile_image, class: "plofile-image" %>
                <% end %>
              <% else %>
                <%= link_to user_path(comment.user.id) do %>
                  <%= image_tag 'no_image.jpg', class: "no_image" %>
                <% end %>
              <% end %>
            </div>

            <div class="comments-user-right">
              <div class="name"><%= link_to comment.user.name, user_path(comment.user.id) %></div>
              <div class="car-name"><%= link_to comment.user.maker_genre.mname, user_path(comment.user.id) %>. <%= link_to comment.user.car_name, user_path(comment.user.id) %></div>
            </div>
          </div>

          <div class="comment">
            <div class="chatting">
              <div class="says">
                <p><%= comment.post_comment %></p>
              </div>
            </div>
          </div>
        </div>
      <% end %>



</div>